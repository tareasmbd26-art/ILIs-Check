<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagnóstico Paneles Gamewell-FCI v3.0</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            min-height: 100vh;
            padding: 10px;
            color: #334155;
        }

        .container { max-width: 900px; margin: 0 auto; }

        .header {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border-bottom: 5px solid #2563eb;
        }

        .header h1 { color: #1e3a8a; font-size: clamp(1.5rem, 5vw, 2rem); margin-bottom: 8px; }
        .header p { color: #64748b; font-size: clamp(0.9rem, 3vw, 1rem); }

        /* Estilo para el Disclaimer */
        .disclaimer-box {
            background: #fffbeb;
            border: 1px solid #fcd34d;
            border-left: 5px solid #d97706;
            color: #92400e;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.9rem;
            line-height: 1.5;
            display: flex;
            gap: 12px;
            align-items: start;
        }

        .progress-container {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .progress-bar { width: 100%; height: 8px; background: #e2e8f0; border-radius: 10px; overflow: hidden; margin-top: 5px; }
        .progress-fill { height: 100%; background: #3b82f6; transition: width 0.3s ease; }

        .main-card {
            background: white;
            border-radius: 12px;
            padding: clamp(20px, 5vw, 35px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            min-height: 400px;
            display: flex;
            flex-direction: column;
        }

        .step-title { display: flex; align-items: center; margin-bottom: 20px; gap: 10px; }
        .step-title h2 { color: #1e293b; font-size: clamp(1.2rem, 4vw, 1.5rem); }

        .question-box {
            background: #f1f5f9;
            border-left: 4px solid #64748b;
            padding: clamp(15px, 4vw, 25px);
            margin-bottom: 20px;
            border-radius: 8px;
        }
        .question-box p { font-size: clamp(1rem, 3vw, 1.15rem); font-weight: 600; line-height: 1.6; }

        /* Estilos de Diagnóstico */
        .diagnosis-box { padding: clamp(15px, 4vw, 25px); margin-bottom: 20px; border-radius: 8px; border-left: 5px solid; }
        
        .diagnosis-bad { background: #fef2f2; border-color: #dc2626; }
        .diagnosis-bad h3 { color: #991b1b; }
        .diagnosis-bad p { color: #dc2626; font-weight: 500; }

        .diagnosis-good { background: #ecfdf5; border-color: #059669; }
        .diagnosis-good h3 { color: #065f46; }
        .diagnosis-good p { color: #059669; font-weight: 500; }

        .take-photo {
            display: block;
            margin-top: 10px;
            color: #dc2626;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-top: 1px dashed #fca5a5;
            padding-top: 8px;
        }

        .warning-note {
            background-color: #fff7ed;
            border: 1px solid #fdba74;
            color: #c2410c;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 15px;
            font-size: 0.9rem;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        /* Botones */
        .options { display: flex; flex-direction: column; gap: 12px; margin-bottom: 20px; }
        
        .btn {
            padding: 15px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.1s;
            text-align: left;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .btn:active { transform: scale(0.98); }

        .btn-yes { background: #16a34a; color: white; box-shadow: 0 4px 6px rgba(22, 163, 74, 0.2); }
        .btn-yes:hover { background: #15803d; }

        .btn-no { background: #dc2626; color: white; box-shadow: 0 4px 6px rgba(220, 38, 38, 0.2); }
        .btn-no:hover { background: #b91c1c; }

        .btn-neutral { background: #2563eb; color: white; box-shadow: 0 4px 6px rgba(37, 99, 235, 0.2); }
        .btn-neutral:hover { background: #1d4ed8; }

        .nav-buttons { margin-top: auto; display: flex; gap: 10px; border-top: 1px solid #e2e8f0; padding-top: 20px; }
        .btn-nav { padding: 10px 20px; border-radius: 6px; font-weight: 600; cursor: pointer; border: none; }
        .btn-back { background: #e2e8f0; color: #475569; }
        .btn-reset { background: #334155; color: white; margin-left: auto; }

        .history-container { margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 8px; }
        .history-tag { display: inline-block; background: #3b82f6; color: white; padding: 4px 10px; border-radius: 15px; font-size: 0.75rem; margin: 2px; }

    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Diagnóstico Paneles Gamewell-FCI</h1>
            <p>Guía Técnica Interactiva | v3.0</p>
        </div>

        <div class="disclaimer-box">
            <svg style="flex-shrink:0" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
            <div>
                <strong>NOTA IMPORTANTE PARA EL TÉCNICO:</strong><br>
                Esta herramienta es una guía de apoyo lógica basada en manuales y procedimientos estándar. No sustituye su juicio profesional ni su experiencia en campo. Realice las pruebas bajo su propio criterio y siguiendo las normas de seguridad eléctrica.
            </div>
        </div>

        <div class="progress-container">
            <div style="display: flex; justify-content: space-between; font-size: 0.9rem;">
                <span>Progreso</span>
                <span id="stepCounter">Paso 1</span>
            </div>
            <div class="progress-bar"><div class="progress-fill" id="progressFill" style="width: 5%"></div></div>
        </div>

        <div class="main-card">
            <div id="contentArea"></div>
            <div class="nav-buttons" id="navButtons"></div>
        </div>

        <div class="history-container">
            <h3 style="color: #cbd5e1; font-size: 0.9rem; margin-bottom: 10px;">Ruta tomada:</h3>
            <div id="historyTags"></div>
        </div>
    </div>

    <script>
        const steps = {
            // --- INICIO GLOBAL ---
            inicio: {
                title: "Selección de Componente",
                question: "¿Qué componente del sistema va a diagnosticar hoy?",
                type: "question",
                options: [
                    { label: "Tarjeta ILI (Lazo/CPU)", next: "ili_start" },
                    { label: "Tarjeta de Voz (VG: VGC/VGX)", next: "vg_select" },
                    { label: "Fuente PM-9", next: "pm9_check" },
                    { label: "Pantallas / LCD", next: "falla_lcd" }
                ]
            },

            // ==========================================
            // RAMA ILI (Modificada y Mejorada)
            // ==========================================
            ili_start: {
                title: "Estado Inicial ILI",
                question: "¿Los LEDs de la tarjeta ILI están encendidos?",
                type: "question",
                options: [
                    { label: "Sí, están encendidos", next: "tipo_falla_ili" },
                    { label: "No, están apagados", next: "ili_leds_no" }
                ]
            },
            ili_leds_no: {
                title: "Revisión de Fuente PM-9",
                question: "Verificar fuente PM-9. ¿La fuente PM-9 está encendida?",
                type: "question",
                options: [
                    { label: "Sí, PM-9 enciende", next: "pm9_si" },
                    { label: "No, PM-9 apagada", next: "pm9_no" }
                ]
            },
            pm9_check: { // Acceso directo desde menú
                title: "Diagnóstico PM-9",
                question: "¿La fuente PM-9 enciende sus indicadores?",
                type: "question",
                options: [
                    { label: "Sí", next: "pm9_si" },
                    { label: "No", next: "pm9_no" }
                ]
            },
            pm9_no: {
                title: "Falla de Alimentación",
                type: "diagnosis",
                status: "bad",
                result: "PROBLEMA: Sin alimentación en la fuente. Verificar entrada AC o reemplazar fuente PM-9."
            },
            pm9_si: {
                title: "Verificación Voltaje TB-1",
                question: "Medir 24VDC en conector TB-1 de la ILI. ¿Están presentes los 24VDC?",
                type: "question",
                options: [
                    { label: "Sí, hay 24VDC", next: "ili_power_cycle" },
                    { label: "No hay voltaje", next: "tb1_no" }
                ]
            },
            ili_power_cycle: {
                title: "Reinicio Físico ILI",
                question: "⚠️ ADVERTENCIA: Verifique el cable Ribbon (J1 ILI <-> J1 PM-9).<br><br>Hay voltaje pero la ILI no enciende. Desconecte la alimentación de la ILI, espere 10 segundos y reconecte. ¿Encendió?",
                warning: true,
                type: "question",
                options: [
                    { label: "Sí, ahora encendió", next: "tipo_falla_ili" },
                    { label: "No, sigue muerta", next: "ili_dead" }
                ]
            },
            ili_dead: {
                title: "ILI Dañada",
                type: "diagnosis",
                status: "bad",
                result: "PROBLEMA: ILI recibe voltaje pero no enciende tras reinicio físico. Tarjeta dañada internamente."
            },
            tb1_no: {
                title: "Problema Físico",
                type: "diagnosis",
                status: "bad",
                result: "PROBLEMA: PM-9 enciende pero no entrega voltaje en TB-1. Revisar cableado entre PM-9 e ILI, señales de fogueo o pistas levantadas."
            },

            // Sub-ramas de ILI (Red, Lazo, Ground Fault)
            tipo_falla_ili: {
                title: "Selección de Falla ILI",
                question: "La ILI está encendida. ¿Cuál es el problema?",
                type: "question",
                options: [
                    { label: "No reconoce dispositivos", next: "reconoce_no" },
                    { label: "Ground Fault (Tierra)", next: "gf_start" },
                    { label: "Falla de Red / RPT", next: "rpt_check_leds" }
                ]
            },
            
            // Lógica Ground Fault (reutilizada y optimizada)
            gf_start: {
                title: "Configuración W9",
                question: "Verifique Dipswitch W9. ¿Está en 'Disb'?",
                type: "question",
                options: [{ label: "Sí", next: "gf_check_grounds" }, { label: "No", next: "gf_fix_w9" }]
            },
            gf_fix_w9: { title: "Corrección W9", type: "diagnosis", status: "good", result: "SOLUCIÓN: Poner W9 en 'Disb' para eliminar tierra falsa." },
            gf_check_grounds: {
                title: "Revisión Tierras",
                question: "Revise puestas a tierra (ILI, LCD, RPT). ¿Correctas?",
                type: "question",
                options: [{ label: "Sí", next: "gf_iso_loops" }, { label: "No", next: "gf_fix_grounds" }]
            },
            gf_fix_grounds: { title: "Corrección Tierras", type: "diagnosis", status: "good", result: "SOLUCIÓN: Corregir tierras físicas." },
            gf_iso_loops: {
                title: "Aislar Lazos",
                question: "Desconecte lazos SLC. ¿Desaparece la tierra?",
                type: "question",
                options: [{ label: "Sí", next: "gf_field" }, { label: "No", next: "gf_iso_board" }]
            },
            gf_field: { title: "Falla en Campo", type: "diagnosis", status: "bad", result: "PROBLEMA: Falla a tierra en cableado de campo." },
            gf_iso_board: {
                title: "Aislar Tarjeta",
                question: "Aísle la ILI del chasis (sáquela de los postes). ¿Desaparece la falla?",
                type: "question",
                options: [{ label: "Sí", next: "gf_short_box" }, { label: "No", next: "gf_ili_bad" }]
            },
            gf_short_box: { title: "Corto con Caja", type: "diagnosis", status: "bad", result: "PROBLEMA: Corto físico entre tarjeta y gabinete." },
            gf_ili_bad: { title: "ILI Dañada", type: "diagnosis", status: "bad", result: "PROBLEMA: Falla a tierra interna en ILI." },

            // Lógica No Reconoce Dispositivos
            reconoce_no: {
                title: "Voltaje Lazo",
                question: "Medir voltaje Lazo 1 y 2. ¿Está entre 18V y 22V?",
                type: "question",
                options: [{ label: "Sí", next: "test_dev_one" }, { label: "No", next: "loop_volt_bad" }]
            },
            loop_volt_bad: { title: "Salida Lazo Mala", type: "diagnosis", status: "bad", result: "PROBLEMA: Salida de voltaje de lazo dañada." },
            test_dev_one: {
                title: "Prueba Unitaria",
                question: "Conectar UN dispositivo con cable corto directo a ILI. ¿Lo reconoce?",
                type: "question",
                options: [{ label: "Sí", next: "field_wiring_bad" }, { label: "No", next: "loop_circuit_bad" }]
            },
            field_wiring_bad: { title: "Cableado Campo", type: "diagnosis", status: "bad", result: "PROBLEMA: ILI OK. Problema en cableado de campo (abierto/corto)." },
            loop_circuit_bad: { title: "ILI Lazo Dañado", type: "diagnosis", status: "bad", result: "PROBLEMA: ILI no lee datos del lazo. Reemplazar tarjeta." },


            // ==========================================
            // RAMA VG (VOZ - VGC / VGX)
            // ==========================================
            vg_select: {
                title: "Tipo de Tarjeta de Voz",
                question: "¿Qué modelo de tarjeta está revisando?",
                type: "question",
                options: [
                    { label: "VGC (Controlador)", next: "vg_leds_check_vgc" },
                    { label: "VGX (Expansor)", next: "vg_leds_check_vgx" }
                ]
            },
            
            // --- VGC ---
            vg_leds_check_vgc: {
                title: "Estado LEDs VGC",
                question: "Observe los LEDs de la VGC. ¿Cómo están?",
                type: "question",
                options: [
                    { label: "Todos APAGADOS", next: "vgc_power_check" },
                    { label: "Encendidos pero RX/TX Apagados", next: "vg_net_check" },
                    { label: "Encendidos y RX/TX Parpadeando", next: "vg_config_check" }
                ]
            },
            vgc_power_check: {
                title: "Alimentación VGC",
                question: "Mida voltaje en TB2 de la VGC. ¿Hay 24VDC?",
                type: "question",
                options: [
                    { label: "Sí, hay voltaje", next: "vgc_reboot" },
                    { label: "No hay voltaje", next: "vg_no_power_input" }
                ]
            },
            vgc_reboot: {
                title: "Reinicio VGC",
                question: "Hay voltaje pero está apagada. Desconecte y reconecte la alimentación (TB2). ¿Levantó y hay comunicación (RX/TX)?",
                type: "question",
                options: [
                    { label: "Sí, levantó y comunica", next: "vg_ok_temp" },
                    { label: "Levantó pero NO comunica", next: "vg_net_check" },
                    { label: "No, sigue apagada", next: "vgc_dead" }
                ]
            },
            vgc_dead: { title: "VGC Dañada", type: "diagnosis", status: "bad", result: "PROBLEMA: VGC recibe voltaje pero no enciende tras reinicio. Reemplazar VGC." },

            // --- VGX ---
            vg_leds_check_vgx: {
                title: "Estado LEDs VGX",
                question: "Observe los LEDs de la VGX. ¿Cómo están?",
                type: "question",
                options: [
                    { label: "Todos APAGADOS", next: "vgx_power_check" },
                    { label: "Encendidos pero RX/TX Apagados", next: "vg_net_check" },
                    { label: "Encendidos y RX/TX Parpadeando", next: "vgx_config_check" }
                ]
            },
            vgx_power_check: {
                title: "Alimentación VGX",
                question: "Mida voltaje en TB2 y J4 de la VGX. ¿Hay voltaje presente?",
                type: "question",
                options: [
                    { label: "Sí, hay voltaje", next: "vgx_reboot" },
                    { label: "No hay voltaje", next: "vg_no_power_input" }
                ]
            },
            vgx_reboot: {
                title: "Reinicio VGX",
                question: "Desconecte y reconecte la alimentación. ¿Levantó y hay comunicación (RX/TX)?",
                type: "question",
                options: [
                    { label: "Sí, todo OK", next: "vg_ok_temp" },
                    { label: "Levantó pero NO comunica", next: "vg_net_check" },
                    { label: "No, sigue apagada", next: "vgx_dead" }
                ]
            },
            vgx_dead: { title: "VGX Dañada", type: "diagnosis", status: "bad", result: "PROBLEMA: VGX no enciende. Reemplazar tarjeta." },

            // --- Comunes VG ---
            vg_no_power_input: { title: "Sin Energía", type: "diagnosis", status: "bad", result: "PROBLEMA: No llega voltaje a la tarjeta. Revisar fuente o cableado previo." },
            vg_ok_temp: { title: "Recuperado", type: "diagnosis", status: "good", result: "SOLUCIONADO: El reinicio restauró la operación. Monitorear." },
            
            vg_net_check: {
                title: "Revisión de Red VG",
                question: "RX/TX no muestran actividad. Revise la conexión con la RPT, VGC o VGX del nodo anterior/siguiente. ¿Están encendidos esos nodos?",
                type: "question",
                options: [
                    { label: "Sí, vecinos encendidos", next: "vg_cable_check" },
                    { label: "No, vecino apagado", next: "vg_neighbor_dead" }
                ]
            },
            vg_neighbor_dead: { title: "Nodo Vecino Caído", type: "diagnosis", status: "bad", result: "PROBLEMA: La pérdida de comunicación viene del nodo adyacente apagado." },
            vg_cable_check: { title: "Falla Comunicación", type: "diagnosis", status: "bad", result: "PROBLEMA: Vecinos OK pero no hay datos. Revisar cableado de red o puerto de red dañado en VG." },

            vg_config_check: {
                title: "Recargar Configuración",
                question: "La tarjeta comunica pero no opera bien. Intente recargar la configuración.",
                type: "question",
                options: [
                    { label: "Ya funciona", next: "vg_fixed_soft" },
                    { label: "Sigue fallando", next: "vg_hard_fail" }
                ]
            },
            vgx_config_check: {
                title: "Recargar Config y Audio",
                question: "La VGX comunica pero falla. Recargue la configuración Y los archivos de Audio.",
                type: "question",
                options: [
                    { label: "Ya funciona", next: "vg_fixed_soft" },
                    { label: "Sigue fallando", next: "vg_hard_fail" }
                ]
            },
            vg_fixed_soft: { title: "Error de Software", type: "diagnosis", status: "good", result: "SOLUCIONADO: Error de configuración/audio corrupto corregido." },
            vg_hard_fail: { title: "Falla Hardware", type: "diagnosis", status: "bad", result: "PROBLEMA: Falla interna de la tarjeta de voz a pesar de tener soft correcto. Reemplazar." },


            // ==========================================
            // RAMA PANTALLAS (LCD)
            // ==========================================
            falla_lcd: {
                title: "Diagnóstico LCD",
                question: "Verificar voltaje en TB3 (terminales 8-9 y 4-5). ¿Hay voltaje?",
                type: "question",
                options: [{ label: "Sí", next: "lcd_cable_test" }, { label: "No", next: "lcd_no_volt" }]
            },
            lcd_no_volt: { title: "Salida LCD Dañada", type: "diagnosis", status: "bad", result: "PROBLEMA: Sin voltaje en salida para LCD. ILI dañada." },
            lcd_cable_test: {
                title: "Prueba de Cable",
                question: "Reemplazar cable existente (usar stranded). ¿Levanta comunicación?",
                type: "question",
                options: [{ label: "Sí, funciona", next: "lcd_fixed" }, { label: "No, sigue igual", next: "lcd_broken" }]
            },
            lcd_fixed: { title: "Cable Defectuoso", type: "diagnosis", status: "good", result: "SOLUCIONADO: El problema era el cable de comunicación." },
            lcd_broken: { title: "LCD Dañado", type: "diagnosis", status: "bad", result: "PROBLEMA: LCD dañado. Revisar sulfatación. Reemplazar LCD." },

            // ==========================================
            // RAMA RED / RPT (Común)
            // ==========================================
            rpt_check_leds: {
                title: "Estado de RPT",
                question: "⚠️ ADVERTENCIA: NUNCA desconecte la tarjeta RPT con la ILI encendida.<br><br>¿Los LEDs de la tarjeta RPT están encendidos?",
                warning: true,
                type: "question",
                options: [
                    { label: "Sí, encendidos", next: "rpt_comms_check" },
                    { label: "No, apagados", next: "rpt_dead" }
                ]
            },
            rpt_dead: {
                title: "Prueba Cruzada RPT",
                question: "Pruebe la RPT en otra ILI (apagando sistema antes). ¿Enciende?",
                type: "question",
                options: [{ label: "Sí", next: "rpt_integ_fail" }, { label: "No", next: "rpt_fail" }]
            },
            rpt_integ_fail: { title: "Puerto ILI Dañado", type: "diagnosis", status: "bad", result: "PROBLEMA: Puerto de integración en ILI dañado. RPT está bien." },
            rpt_fail: { title: "RPT Dañada", type: "diagnosis", status: "bad", result: "PROBLEMA: Tarjeta RPT dañada. Reemplazar." },
            rpt_comms_check: {
                title: "Tráfico de Datos",
                question: "¿LEDs RX/TX indican actividad?",
                type: "question",
                options: [{ label: "Sí", next: "rpt_ribbon_check" }, { label: "No", next: "rpt_neighbor_check" }]
            },
            rpt_neighbor_check: {
                title: "Vecinos",
                question: "Verifique nodo anterior/siguiente. ¿Están encendidos?",
                type: "question",
                options: [{ label: "Sí", next: "rpt_wiring_bad" }, { label: "No", next: "rpt_neighbor_bad" }]
            },
            rpt_wiring_bad: { title: "Cableado Red", type: "diagnosis", status: "bad", result: "PROBLEMA: Daño en cableado fibra/cobre entre nodos." },
            rpt_neighbor_bad: { title: "Vecino Caído", type: "diagnosis", status: "bad", result: "PROBLEMA: Nodo adyacente apagado causa pérdida de red." },
            rpt_ribbon_check: {
                title: "Ribbon",
                question: "Verifique cable Ribbon ILI-RPT. ¿Bien conectado?",
                type: "question",
                options: [{ label: "Estaba flojo", next: "rpt_loose" }, { label: "Está bien", next: "rpt_logic_bad" }]
            },
            rpt_loose: { title: "Ajustado", type: "diagnosis", status: "good", result: "SOLUCIÓN: Ribbon flojo ajustado." },
            rpt_logic_bad: { title: "RPT Lógica", type: "diagnosis", status: "bad", result: "PROBLEMA: RPT enciende pero no procesa datos. Reemplazar RPT." }
        };

        let currentStep = 'inicio';
        let history = ['inicio'];

        function render() {
            const step = steps[currentStep];
            const contentArea = document.getElementById('contentArea');
            const navButtons = document.getElementById('navButtons');
            
            document.getElementById('stepCounter').textContent = `Paso ${history.length}`;
            let progress = Math.min(history.length * 10, 100);
            document.getElementById('progressFill').style.width = `${progress}%`;

            let html = '';
            
            let icon = step.type === 'diagnosis' 
                ? (step.status === 'good' 
                    ? '<svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#059669" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>'
                    : '<svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#dc2626" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>')
                : '<svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#2563eb" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></svg>';

            html += `<div class="step-title">${icon}<h2>${step.title}</h2></div>`;

            if (step.warning) {
                html += `
                    <div class="warning-note">
                        <svg style="flex-shrink:0" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
                        <span>ADVERTENCIA: ${step.title === 'Estado de RPT' ? 'Riesgo de daño en RPT.' : 'Riesgo de hardware.'} Lea atentamente.</span>
                    </div>
                `;
            }

            if (step.type === 'question') {
                html += `<div class="question-box"><p>${step.question}</p></div>`;
                html += `<div class="options">`;
                step.options.forEach(opt => {
                    let btnClass = 'btn-neutral';
                    const label = opt.label.toLowerCase();
                    if (label.includes('sí') || label.includes('si,') || label.includes('funciona') || label.includes('desaparece') || label.includes('encendidos')) btnClass = 'btn-yes';
                    if (label.startsWith('no') || label.includes('sigue') || label.includes('apagado') || label.includes('falla')) btnClass = 'btn-no';
                    
                    html += `<button class="btn ${btnClass}" onclick="goToStep('${opt.next}')"><span>${opt.label}</span><svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg></button>`;
                });
                html += `</div>`;
            } else {
                const diagClass = step.status === 'good' ? 'diagnosis-good' : 'diagnosis-bad';
                html += `<div class="diagnosis-box ${diagClass}"><h3>Resultado</h3><p>${step.result}</p><span class="take-photo">TOMAR FOTO</span></div>`;
            }

            contentArea.innerHTML = html;

            let navHtml = '';
            if (history.length > 1) navHtml += `<button class="btn-nav btn-back" onclick="goBack()">← Anterior</button>`;
            navHtml += `<button class="btn-nav btn-reset" onclick="reset()">Reiniciar ↻</button>`;
            navButtons.innerHTML = navHtml;

            document.getElementById('historyTags').innerHTML = history.map(stepId => `<span class="history-tag">${steps[stepId].title}</span>`).join('');
        }

        function goToStep(nextStep) {
            history.push(nextStep);
            currentStep = nextStep;
            render();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function goBack() {
            if (history.length > 1) {
                history.pop();
                currentStep = history[history.length - 1];
                render();
            }
        }

        function reset() {
            currentStep = 'inicio';
            history = ['inicio'];
            render();
        }

        render();
    </script>
</body>
</html>